<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" crossorigin="anonymous" defer>
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, deleteDoc, addDoc, onSnapshot, collection, query, where, orderBy, serverTimestamp, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase configuration and initialization
        const firebaseConfig = {
  apiKey: "AIzaSyDy5YOQlQhjiRWSyF5LToop-k1cyOA4tnA",
  authDomain: "calculatarr.firebaseapp.com",
  projectId: "calculatarr",
  storageBucket: "calculatarr.firebasestorage.app",
  messagingSenderId: "20289379509",
  appId: "1:20289379509:web:a9e74f6927c067086032fc"
};
const initialAuthToken = null;
const appId = 'chat-app';

        let db;
        let auth;
        let userId;
        let currentReply = null;
        let isCasting = false;
        let cameraStream = null;

        const GIPHY_API_KEY = 'YOUR_GIPHY_API_KEY'; // ‡§Ö‡§™‡§®‡•Ä Giphy API ‡§ï‡•Å‡§Ç‡§ú‡•Ä ‡§ï‡•ã ‡§Ø‡§π‡§æ‡§Å ‡§¨‡§¶‡§≤‡•á‡§Ç

        const initFirebase = async () => {
            if (Object.keys(firebaseConfig).length === 0) {
                console.error("Firebase config is not available. Please check the environment settings.");
                return;
            }
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            setLogLevel('Debug');

            if (initialAuthToken) {
                try {
                    await signInWithCustomToken(auth, initialAuthToken);
                } catch (error) {
                    console.error("Error signing in with custom token:", error);
                    await signInAnonymously(auth);
                }
            } else {
                await signInAnonymously(auth);
            }
            userId =  auth.currentUser?.uid || 
         (self.crypto && crypto.randomUUID 
             ? crypto.randomUUID() 
             : Math.random().toString(36).substring(2));

            // Set up real-time listener for messages
            const messagesCollectionRef = collection(db, `artifacts/${appId}/public/data/messages`);
            const q = query(messagesCollectionRef, orderBy('timestamp'));

            onSnapshot(q, (snapshot) => {
                const messages = [];
                snapshot.forEach(doc => {
                    messages.push({ id: doc.id, ...doc.data() });
                });
                renderMessages(messages);
            });

            // Display GOMU instead of user ID
            document.getElementById('userIdDisplay').textContent = 'GOMU';
        };

        const renderMessages = (messages) => {
            const chatBox = document.getElementById('chatBox');
            chatBox.innerHTML = '';
            messages.forEach(msg => {
                const messageContainer = document.createElement('div');
                messageContainer.classList.add('flex', 'my-1', 'w-full');
                if (msg.userId === userId) {
                    messageContainer.classList.add('justify-end');
                } else {
                    messageContainer.classList.add('justify-start');
                }

                const messageElement = document.createElement('div');
                messageElement.classList.add('p-2', 'rounded-lg', 'cursor-pointer', 'max-w-[75%]', 'word-break-all');

                if (msg.userId === userId) {
                    messageElement.classList.add('bg-blue-500', 'text-white', 'rounded-br-none');
                } else {
                    messageElement.classList.add('bg-gray-200', 'text-gray-800', 'rounded-bl-none');
                }

                // Add reply context if message is a reply
                if (msg.repliedTo) {
                    const replyContext = document.createElement('div');
                    replyContext.classList.add('bg-gray-400', 'text-sm', 'p-1', 'rounded-md', 'mb-1', 'truncate');
                    replyContext.textContent = `${msg.repliedTo.content}`;
                    messageElement.appendChild(replyContext);
                }

                if (msg.type === 'text') {
                    const messageText = document.createElement('p');
                    messageText.textContent = msg.content;
                    messageElement.appendChild(messageText);
                } else if (msg.type === 'image') {
                    const messageImage = document.createElement('img');
                    messageImage.src = msg.content;
                    messageImage.classList.add('rounded-lg', 'max-w-full', 'max-h-60', 'object-contain');
                    messageElement.classList.remove('p-2');
                    messageElement.appendChild(messageImage);
                } else if (msg.type === 'gif') {
                    const messageGif = document.createElement('img');
                    messageGif.src = msg.content;
                    messageGif.classList.add('rounded-lg', 'max-w-full', 'max-h-60', 'object-contain');
                    messageElement.classList.remove('p-2');
                    messageElement.appendChild(messageGif);
                }
                
                // Add status checkmarks for sent messages
                if (msg.userId === userId) {
                    const statusSpan = document.createElement('span');
                    statusSpan.classList.add('ml-2', 'text-xs', 'self-end');
                    if (msg.status === 'read') {
                        statusSpan.classList.add('text-green-500');
                        statusSpan.innerHTML = '&#10003;&#10003;'; // Double checkmark
                    } else {
                        statusSpan.classList.add('text-gray-400');
                        statusSpan.innerHTML = '&#10003;&#10003;'; // Delivered checkmark
                    }
                    messageElement.appendChild(statusSpan);
                } else {
                    // Mark message as read if it's from another user and not yet read
                    if (msg.status !== 'read') {
                        markMessageAsRead(msg.id);
                    }
                }
                
                // Add click listener to select a message to reply to
                messageElement.addEventListener('click', () => {
                    currentReply = {
                        id: msg.id,
                        content: msg.content
                    };
                    document.getElementById('replyBox').classList.remove('hidden');
                    document.getElementById('replyContent').textContent = msg.type === 'text' ? currentReply.content : (msg.type === 'image' ? 'Image' : 'GIF');
                    document.getElementById('chatInput').focus();
                });
                
                // Add long-press listener for deletion
                messageElement.addEventListener('contextmenu', (e) => {
                    e.preventDefault(); // Prevent default browser context menu
                    // Only allow deletion of own messages
                    if (msg.userId === userId) {
                        const deleteModal = document.getElementById('deleteModal');
                        deleteModal.classList.remove('hidden');
                        document.getElementById('deleteButton').onclick = () => {
                            deleteMessage(msg.id);
                            deleteModal.classList.add('hidden');
                        };
                        document.getElementById('cancelDeleteButton').onclick = () => {
                            deleteModal.classList.add('hidden');
                        };
                    }
                });
                messageContainer.appendChild(messageElement);
                chatBox.appendChild(messageContainer);
            });
            // Automatically scroll to the bottom to show the newest messages
            chatBox.scrollTop = chatBox.scrollHeight;
        };

        const sendMessage = async (type, content) => {
            if (!content) return;
            try {
                const messagesCollectionRef = collection(db, `artifacts/${appId}/public/data/messages`);
                const messageData = {
                    type: type, // 'text', 'image' or 'gif'
                    content: content,
                    userId: userId,
                    timestamp: serverTimestamp(),
                    status: 'sent' // Initial status
                };

                if (currentReply) {
                    messageData.repliedTo = {
                        id: currentReply.id,
                        content: currentReply.content
                    };
                    currentReply = null;
                    document.getElementById('replyBox').classList.add('hidden');
                }

                await addDoc(messagesCollectionRef, messageData);
            } catch (e) {
                console.error("Error adding document: ", e);
            }
        };
        
        const markMessageAsRead = async (messageId) => {
            try {
                const messageDocRef = doc(db, `artifacts/${appId}/public/data/messages`, messageId);
                await updateDoc(messageDocRef, {
                    status: 'read'
                });
            } catch (e) {
                console.error("Error marking message as read:", e);
            }
        };

        const deleteMessage = async (messageId) => {
            try {
                const messageDocRef = doc(db, `artifacts/${appId}/public/data/messages`, messageId);
                await deleteDoc(messageDocRef);
                console.log("Message successfully deleted!");
            } catch (e) {
                console.error("Error deleting message:", e);
            }
        };

        const showCameraModal = async () => {
            const cameraModal = document.getElementById('cameraModal');
            const videoElement = document.getElementById('cameraVideo');
            cameraModal.classList.remove('hidden');
            try {
                cameraStream = await navigator.mediaDevices.getUserMedia({ video: true });
                videoElement.srcObject = cameraStream;
            } catch (err) {
                console.error("Error accessing camera:", err);
                const messageBox = document.createElement('div');
                messageBox.classList.add('fixed', 'bottom-4', 'left-1/2', '-translate-x-1/2', 'bg-red-500', 'text-white', 'px-4', 'py-2', 'rounded-lg', 'shadow-lg', 'z-50', 'transition-opacity', 'duration-500');
                messageBox.textContent = '‡§ï‡•à‡§Æ‡§∞‡§æ ‡§§‡§ï ‡§™‡§π‡•Å‡§Å‡§ö‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•Å‡§à‡•§';
                document.body.appendChild(messageBox);
                setTimeout(() => {
                    messageBox.classList.add('opacity-0');
                    setTimeout(() => messageBox.remove(), 500);
                }, 2000);
                closeCameraModal();
            }
        };

        const closeCameraModal = () => {
            const cameraModal = document.getElementById('cameraModal');
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            cameraModal.classList.add('hidden');
        };

        const takePhoto = () => {
            const videoElement = document.getElementById('cameraVideo');
            const canvasElement = document.getElementById('cameraCanvas');
            const context = canvasElement.getContext('2d');
            canvasElement.width = videoElement.videoWidth;
            canvasElement.height = videoElement.videoHeight;
            context.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);
            const dataUrl = canvasElement.toDataURL('image/jpeg');
            sendMessage('image', dataUrl);
            closeCameraModal();
        };

        const showGifModal = () => {
            const gifModal = document.getElementById('gifModal');
            gifModal.classList.remove('hidden');
            loadGifs(); // Load trending GIFs by default
        };

        const closeGifModal = () => {
            const gifModal = document.getElementById('gifModal');
            gifModal.classList.add('hidden');
            document.getElementById('gifSearchInput').value = '';
            document.getElementById('gifGrid').innerHTML = ''; // Clear the grid
        };

        const loadGifs = async (query = '') => {
            const gifGrid = document.getElementById('gifGrid');
            const loadingIndicator = document.getElementById('gifLoadingIndicator');
            gifGrid.innerHTML = '';
            loadingIndicator.classList.remove('hidden');

            const url = query
                ? `https://api.giphy.com/v1/gifs/search?api_key=${GIPHY_API_KEY}&q=${query}&limit=25&rating=g`
                : `https://api.giphy.com/v1/gifs/trending?api_key=${GIPHY_API_KEY}&limit=25&rating=g`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                loadingIndicator.classList.add('hidden');
                
                if (data.data.length === 0) {
                    gifGrid.innerHTML = '<p class="text-gray-400">‡§ï‡•ã‡§à GIF ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§</p>';
                    return;
                }

                data.data.forEach(gif => {
                    const img = document.createElement('img');
                    img.src = gif.images.fixed_height.url;
                    img.classList.add('rounded-lg', 'cursor-pointer', 'shadow-md', 'transition-transform', 'hover:scale-105');
                    img.alt = gif.title;
                    img.addEventListener('click', () => {
                        sendMessage('gif', img.src);
                        closeGifModal();
                    });
                    gifGrid.appendChild(img);
                });
            } catch (error) {
                console.error('Error fetching GIFs:', error);
                loadingIndicator.classList.add('hidden');
                gifGrid.innerHTML = '<p class="text-red-400">GIFs ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•Å‡§à‡•§</p>';
            }
        };

        window.onload = () => {
            initFirebase();

            const screen = document.getElementById('screen');
            const chatContainer = document.getElementById('chatContainer');
            const calculatorContainer = document.getElementById('calculatorContainer');
            const castOverlay = document.getElementById('castOverlay');
            const settingsModal = document.getElementById('settingsModal');
            const passwordInput = document.getElementById('passwordInput');
            const buttons = document.querySelectorAll('.calculator-btn');
            const chatInput = document.getElementById('chatInput'); // Get the textarea element
            const defaultPassword = '8107';
            let secretPassword = localStorage.getItem('chatPassword') || defaultPassword;
            let currentInput = '';
            let isChatMode = false;
            const CHAT_INPUT_MAX_HEIGHT = 150; // Max height for the chat input in pixels

            const updateScreen = () => {
                screen.textContent = currentInput || '0';
            };

            const toggleMode = (isChat) => {
                isChatMode = isChat;
                calculatorContainer.classList.toggle('hidden', isChat);
                chatContainer.classList.toggle('hidden', !isChat);
                if (isChat) {
                    chatInput.focus();
                } else {
                    currentInput = '';
                    updateScreen();
                }
            };
            
            // New logic to handle app returning from recent apps
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'visible') {
                    toggleMode(false);
                }
            });

            // Screen casting detection logic
            const checkCasting = () => {
                // This is a simplified check and may not work on all browsers/platforms
                const mediaDevices = navigator.mediaDevices;
                if (mediaDevices && mediaDevices.getDisplayMedia) {
                    mediaDevices.getDisplayMedia({ video: true, audio: true })
                        .then(stream => {
                            isCasting = true;
                            castOverlay.classList.remove('hidden');
                            stream.getTracks().forEach(track => track.stop());
                        })
                        .catch(err => {
                            isCasting = false;
                            castOverlay.classList.add('hidden');
                        });
                }
            };

            // Initial check and periodic check
            checkCasting();
            setInterval(checkCasting, 5000); // Check every 5 seconds

            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    const value = button.textContent;
                    if (value === 'C') {
                        currentInput = '';
                    } else if (value === '=') {
                        if (currentInput === secretPassword) {
                            toggleMode(true);
                        } else {
                            try {
                                currentInput = eval(currentInput.replace('√ó', '*').replace('√∑', '/')).toString();
                            } catch {
                                currentInput = 'Error';
                            }
                        }
                    } else {
                        if (currentInput === '0' && ['+', '-', '√ó', '√∑'].includes(value)) {
                            // Do nothing
                        } else if (currentInput.length === 1 && currentInput[0] === '0' && value !== '.') {
                            currentInput = value;
                        } else {
                            currentInput += value;
                        }
                    }
                    updateScreen();
                });
            });

            document.getElementById('chatForm').addEventListener('submit', (e) => {
                e.preventDefault();
                sendMessage('text', chatInput.value);
                chatInput.value = '';
                chatInput.style.height = 'auto'; // Reset height after sending
            });
            
            // Auto-resize the textarea based on content
            chatInput.addEventListener('input', () => {
                chatInput.style.height = 'auto';
                if (chatInput.scrollHeight <= CHAT_INPUT_MAX_HEIGHT) {
                    chatInput.style.height = `${chatInput.scrollHeight}px`;
                } else {
                    chatInput.style.height = `${CHAT_INPUT_MAX_HEIGHT}px`;
                    chatInput.style.overflowY = 'auto';
                }
            });

            const backButton = document.getElementById('backButton');
            backButton.addEventListener('click', () => {
                toggleMode(false);
            });

            document.getElementById('cancelReplyButton').addEventListener('click', () => {
                currentReply = null;
                document.getElementById('replyBox').classList.add('hidden');
            });

            document.getElementById('cameraButton').addEventListener('click', (e) => {
                e.preventDefault();
                showCameraModal();
            });

            document.getElementById('gifButton').addEventListener('click', (e) => {
                e.preventDefault();
                showGifModal();
            });

            document.getElementById('takePhotoButton').addEventListener('click', takePhoto);
            document.getElementById('closeCameraButton').addEventListener('click', closeCameraModal);

            document.getElementById('gifSearchButton').addEventListener('click', () => {
                const query = document.getElementById('gifSearchInput').value;
                loadGifs(query);
            });
            document.getElementById('gifSearchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const query = document.getElementById('gifSearchInput').value;
                    loadGifs(query);
                }
            });
            document.getElementById('closeGifModalButton').addEventListener('click', closeGifModal);

            const showSettingsModal = () => {
                settingsModal.classList.remove('hidden');
            };

            const closeSettingsModal = () => {
                settingsModal.classList.add('hidden');
            };

            const changePassword = () => {
                const newPassword = passwordInput.value;
                if (newPassword && newPassword.length > 0) {
                    secretPassword = newPassword;
                    localStorage.setItem('chatPassword', newPassword);
                    // Use a message box instead of alert
                    const messageBox = document.createElement('div');
                    messageBox.classList.add('fixed', 'bottom-4', 'left-1/2', '-translate-x-1/2', 'bg-green-500', 'text-white', 'px-4', 'py-2', 'rounded-lg', 'shadow-lg', 'z-50', 'transition-opacity', 'duration-500');
                    messageBox.textContent = '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§¶‡§≤ ‡§ó‡§Ø‡§æ ‡§π‡•à!';
                    document.body.appendChild(messageBox);
                    setTimeout(() => {
                        messageBox.classList.add('opacity-0');
                        setTimeout(() => messageBox.remove(), 500);
                    }, 2000);
                    closeSettingsModal();
                } else {
                    // Use a message box instead of alert
                    const messageBox = document.createElement('div');
                    messageBox.classList.add('fixed', 'bottom-4', 'left-1/2', '-translate-x-1/2', 'bg-red-500', 'text-white', 'px-4', 'py-2', 'rounded-lg', 'shadow-lg', 'z-50', 'transition-opacity', 'duration-500');
                    messageBox.textContent = '‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§';
                    document.body.appendChild(messageBox);
                    setTimeout(() => {
                        messageBox.classList.add('opacity-0');
                        setTimeout(() => messageBox.remove(), 500);
                    }, 2000);
                }
            };

            document.getElementById('settingsButton').addEventListener('click', showSettingsModal);
            document.getElementById('changePasswordButton').addEventListener('click', changePassword);
            document.getElementById('closeSettingsButton').addEventListener('click', closeSettingsModal);
        };
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
        }

        /* Adjust textarea to look like a chat input */
        .chat-textarea {
            resize: none;
            overflow-y: hidden;
            line-height: 1.5;
            padding-right: 2.5rem;
        }

        /* This is the key change to make the messages wrap and stay within bounds */
        .word-break-all {
            overflow-wrap: break-word;
            word-break: break-all;
        }
    </style>
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen">
    <div class="p-6 bg-gray-800 shadow-xl rounded-2xl w-full max-w-sm">
        <div id="calculatorContainer">
            <div id="screen" class="bg-gray-700 text-white text-right p-4 rounded-xl text-3xl font-mono mb-4 overflow-x-auto">0</div>
            <div class="grid grid-cols-4 gap-3">
                <button class="calculator-btn bg-gray-700 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-600 active:shadow-none">C</button>
                <button class="calculator-btn bg-gray-700 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-600 active:shadow-none">√∑</button>
                <button class="calculator-btn bg-gray-700 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-600 active:shadow-none">√ó</button>
                <button class="calculator-btn bg-gray-700 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-600 active:shadow-none">-</button>

                <button class="calculator-btn bg-gray-600 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-500 active:shadow-none">7</button>
                <button class="calculator-btn bg-gray-600 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-500 active:shadow-none">8</button>
                <button class="calculator-btn bg-gray-600 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-500 active:shadow-none">9</button>
                <button class="calculator-btn bg-gray-700 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-600 active:shadow-none">+</button>

                <button class="calculator-btn bg-gray-600 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-500 active:shadow-none">4</button>
                <button class="calculator-btn bg-gray-600 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-500 active:shadow-none">5</button>
                <button class="calculator-btn bg-gray-600 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-500 active:shadow-none">6</button>
                <button class="calculator-btn bg-blue-600 text-white row-span-2 rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-blue-700 active:shadow-none">=</button>

                <button class="calculator-btn bg-gray-600 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-500 active:shadow-none">1</button>
                <button class="calculator-btn bg-gray-600 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-500 active:shadow-none">2</button>
                <button class="calculator-btn bg-gray-600 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-500 active:shadow-none">3</button>
                <button class="calculator-btn bg-gray-600 text-white col-span-2 rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-500 active:shadow-none">0</button>
                <button class="calculator-btn bg-gray-600 text-white rounded-xl p-4 text-2xl shadow-md transition-all hover:bg-gray-500 active:shadow-none">.</button>
            </div>
        </div>

        <div id="chatContainer" class="hidden h-[100vh] flex flex-col relative">
            <div class="flex items-center justify-between mb-4">
                <button id="backButton" class="px-4 py-2 bg-gray-700 text-white rounded-lg shadow-md transition-all hover:bg-gray-600 active:shadow-none">Go Back</button>
                <button id="settingsButton" class="px-4 py-2 bg-gray-700 text-white rounded-lg shadow-md transition-all hover:bg-gray-600 active:shadow-none">Settings</button>
                <button id="cameraButton" class="px-3 py-2 bg-gray-600 text-2xl rounded-lg shadow-md transition-all hover:bg-gray-500 active:shadow-none">üì∏</button>
                <button id="gifButton" class="px-3 py-2 bg-gray-600 text-2xl rounded-lg shadow-md transition-all hover:bg-gray-500 active:shadow-none">GIF</button>
            </div>
            <p id="userIdDisplay" class="text-sm text-center text-gray-400 mb-4"></p>
            
            <div id="chatBox" class="flex-grow p-4 bg-gray-700 overflow-y-auto rounded-xl shadow-inner mb-4 flex flex-col">
                <!-- Chat messages will be rendered here -->
            </div>
            
            <div id="replyBox" class="bg-gray-700 p-2 rounded-lg mb-2 hidden">
                <div class="flex items-center justify-between">
                    <p class="text-white truncate mt-1" id="replyContent"></p>
                    <button id="cancelReplyButton" class="text-gray-400 text-lg">&times;</button>
                </div>
            </div>

            <form id="chatForm" class="flex items-end">
                <!-- Replaced input with textarea for multi-line support -->
                <textarea id="chatInput" placeholder="Send a message..." class="flex-grow p-2 rounded-lg border border-gray-600 bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 chat-textarea" rows="1"></textarea>
                <button type="submit" class="ml-2 px-6 py-3 bg-blue-500 text-white rounded-lg shadow-md transition-all hover:bg-blue-600 active:shadow-none text-lg">Send</button>
            </form>
        </div>
    </div>
    
    <!-- Camera Modal -->
    <div id="cameraModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl text-center flex flex-col items-center">
            <h2 class="text-white text-2xl mb-4">‡§´‡§º‡•ã‡§ü‡•ã ‡§≤‡•á‡§Ç</h2>
            <video id="cameraVideo" class="w-full max-w-sm rounded-lg" autoplay playsinline></video>
            <canvas id="cameraCanvas" class="hidden"></canvas>
            <div class="flex justify-center space-x-4 mt-4">
                <button id="takePhotoButton" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">‡§´‡§º‡•ã‡§ü‡•ã ‡§≤‡•á‡§Ç</button>
                <button id="closeCameraButton" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>
    </div>

    <!-- GIF Modal -->
    <div id="gifModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl text-center flex flex-col w-full max-w-lg h-3/4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-white text-2xl">GIF ‡§≠‡•á‡§ú‡•á‡§Ç</h2>
                <button id="closeGifModalButton" class="text-gray-400 text-3xl">&times;</button>
            </div>
            <div class="flex items-center mb-4">
                <input type="text" id="gifSearchInput" placeholder="GIF ‡§ñ‡•ã‡§ú‡•á‡§Ç" class="flex-grow p-2 rounded-lg border border-gray-600 bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button id="gifSearchButton" class="ml-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">‡§ñ‡•ã‡§ú‡•á‡§Ç</button>
            </div>
            <div id="gifLoadingIndicator" class="text-white text-center hidden">GIFs ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</div>
            <div id="gifGrid" class="flex-grow grid grid-cols-2 sm:grid-cols-3 gap-2 overflow-y-auto">
                <!-- GIFs will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl text-center">
            <p class="text-white text-lg mb-4">‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ï‡•ã ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§§‡§∞‡§´ ‡§∏‡•á ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?</p>
            <div class="flex justify-center space-x-4">
                <button id="deleteButton" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">‡§π‡§æ‡§Å, ‡§π‡§ü‡§æ‡§è‡§Å</button>
                <button id="cancelDeleteButton" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">‡§®‡§π‡•Ä‡§Ç, ‡§ï‡•à‡§Ç‡§∏‡§ø‡§≤ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl text-center">
            <h2 class="text-white text-2xl mb-4">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¨‡§¶‡§≤‡•á‡§Ç</h2>
            <input id="passwordInput" type="password" placeholder="‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" class="w-full p-2 mb-4 rounded-lg bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <div class="flex justify-center space-x-4">
                <button id="changePasswordButton" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¨‡§¶‡§≤‡•á‡§Ç</button>
                <button id="closeSettingsButton" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>
    </div>
    
    <!-- Screen Cast Overlay -->
    <div id="castOverlay" class="fixed inset-0 bg-black flex items-center justify-center z-50 hidden">
        <p class="text-white text-2xl">Chat Hidden</p>
    </div>
</body>
</html>
